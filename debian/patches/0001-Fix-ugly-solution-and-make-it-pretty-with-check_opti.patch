From: =?utf-8?q?Yunusemre_=C5=9Eent=C3=BCrk?=
 <yunusemre.senturk@pardus.org.tr>
Date: Thu, 30 Nov 2017 12:05:14 +0300
Subject: Fix ugly solution and make it pretty with check_optictouch
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: 8bit

Signed-off-by: Yunusemre Şentürk <yunusemre.senturk@pardus.org.tr>
---
 eta_gestemas | 27 +++++++++++++++++++++------
 1 file changed, 21 insertions(+), 6 deletions(-)

diff --git a/eta_gestemas b/eta_gestemas
index 26ade04..4cf0aa7 100755
--- a/eta_gestemas
+++ b/eta_gestemas
@@ -1,15 +1,30 @@
 #!/bin/bash
+RED='\033[1;31m'
+YEL='\033[1;33m'
+GREEN='\033[0;32m'
+NC='\033[0m' # No Color
 
-# This is ugly. But without some sleep,
-# it doesn't work with non-hid The Gate Touchscreen Based IWB.
-# Find a better way. Such as systemd --user
+echo -e "${YEL}$0" >> /tmp/eta_log
+u=`/usr/bin/whoami`
+echo -e "${YEL}$0 ${NC}running as ${YEL}$u" >> /tmp/eta_log
 
-sleep 15
+if [ ! -f /tmp/optic_touch.pid ]; then
+    echo -e "${YEL}$0 ${NC}calling ${YEL}/usr/bin/eta-optictouch-busy &" >> /tmp/eta_log
+    /usr/bin/eta-optictouch-busy &
+fi
 
-# Kill running processes if we can.
-killall eta-gestemas
+while [ ! -f /tmp/optic_touch.pid ]
+do
+    sleep 1
+done
+
+echo -e "${YEL}$0 ${NC}eta_gestemas check optic touch loop is ${GREEN}ok!" >> /tmp/eta_log
+echo -e "${YEL}$0 ${NC}terminating every ${YEL}eta-optictouch-busy" >> /tmp/eta_log
+killall eta-optictouch-busy
+sleep 2
 
 # When eta-gestemas crashes this loop brings it back.
+
 while true; do
     /usr/bin/eta-gestemas
     sleep 1
